<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dana and Navya's Summer House</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Georgia, serif; background: #fff; overflow-y: scroll; }
    header {
      background: #101211; color: #F4E3B2;
      padding: 40px 20px; text-align: center;
      font-size: 2.5em; font-style: italic;
      font-family: 'Playfair Display', serif;
    }
    #container { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; padding: 20px; }
    .entry {
      padding: 20px; min-height: 150px; font-size: 12px;
      white-space: pre-wrap; position: relative; border-radius: 4px;
    }
    .blood-red { background: #74070E; color: #F4E3B2; }
    .vanilla { background: #F4E3B2; color: #74070E; }
    .black-bean { background: #310E10; color: #F4E3B2; }
    .drab-brown { background: #45462A; color: #F4E3B2; }
    .cinereous { background: #947268; color: #74070E; }

    .add-button {
      position: fixed; bottom: 20px; right: 20px;
      width: 35px; height: 35px; border-radius: 50%;
      background: #000044; color: white; border: none;
      font-size: 20px; cursor: pointer; line-height: 0;
    }

    .popup {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 999;
    }
    .popup-inner {
      background: white; padding: 20px; border-radius: 10px;
      width: 80%; max-width: 400px;
      display: flex; flex-direction: column; gap: 10px;
    }
    .popup-inner textarea {
      width: 100%; height: 120px;
      resize: vertical; padding: 8px;
      font-family: Georgia, serif; font-size: 14px;
    }
    .popup-inner button {
      align-self: flex-end; padding: 5px 10px;
      font-size: 14px; cursor: pointer;
    }
    .edit-button {
      position: absolute; bottom: 10px; right: 10px;
      width: 16px; height: 16px; background: black;
      border-radius: 50%; cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Dana and Navya's Summer House</header>
  <div id="container"></div>
  <button class="add-button" onclick="openPopup()">+</button>

  <div id="popup" class="popup" style="display:none;">
    <div class="popup-inner">
      <label for="entryText">Enter your paragraph:</label>
      <textarea id="entryText" placeholder="Type here..."></textarea>
      <div>
        <button onclick="submitEntry()">Submit</button>
        <button onclick="closePopup()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const container = document.getElementById('container');
    const popup = document.getElementById('popup');
    const textarea = document.getElementById('entryText');
    const colors = ['blood-red','vanilla','black-bean','drab-brown','cinereous'];
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzqz_PcwC3_iy99fks-7E1XDaQXJx4jo5KgSjMHcs1X6siUPgjVSOw31aCX0_cseZPTNQ/exec';
    let editIndex = null;

    async function loadEntries(){
      try {
        const res = await fetch(scriptURL);
        if (!res.ok) throw new Error(res.status);
        const entries = await res.json();
        container.innerHTML = '';
        entries.forEach((text,i)=>{
          const div = document.createElement('div');
          div.className = `entry ${colors[i%colors.length]}`;
          div.textContent = text;
          const btn = document.createElement('div');
          btn.className = 'edit-button';
          btn.onclick = ()=>{ editIndex=i; textarea.value=text; openPopup(); };
          div.appendChild(btn);
          container.appendChild(div);
        });
      } catch(err){
        console.error('Load error', err);
        container.innerHTML = '<p style="grid-column:1/-1;color:red;text-align:center;">Failed to load entries.</p>';
      }
    }

    function openPopup(){
      textarea.value = editIndex!==null ? textarea.value : '';
      popup.style.display = 'flex';
    }
    function closePopup(){
      popup.style.display = 'none'; editIndex = null;
    }

    async function submitEntry(){
      const text = textarea.value.trim();
      const payload = { text };
      if (editIndex !== null) payload.editIndex = editIndex;
      try {
        const res = await fetch(scriptURL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(res.status);
        closePopup();
        editIndex = null;
        loadEntries();
      } catch(err){
        console.error('Submit error', err);
        alert('Failed to save.');
      }
    }

    window.onload = () => { loadEntries(); };
  </script>
</body>
</html>
